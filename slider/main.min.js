let sliderPlayState=!1,sliderImagenActual=1,sliderTimer=5e3;const databaseUrl="../site/database/";let AlbumId="demo",Album=null,Fotografo=null;const debbugMode=!0,iconsUrl="../site/images/iconos/",ventanas=[...document.querySelectorAll(".ventana")],ventanaInfo=document.getElementById("info"),ventanaSlider=document.getElementById("slider"),ventanaGaleria=document.getElementById("galeria"),masOpciones=document.querySelector("#slider .opciones"),btnToggle=document.getElementById("btnToggle"),sliderImage=document.getElementById("imagen");function abrirVentana(name){"slider"===name?Slider.Play():Slider.Pausa();const ventana=document.getElementById(name);if(!ventana)return console.error(`No existe la ventana ${name}`),!1;ventanas.forEach(item=>item.style.display="none"),ventana.style.display="grid"}function toggleOpciones(){let open=masOpciones.classList.contains("active");console.log(open),open?(Slider.Play(),masOpciones.classList.remove("active")):(Slider.Pausa(),masOpciones.classList.add("active"))}function descargarImage(){const imgSrc=`//${Album.cfg.url}${sliderImagenActual}${Album.cfg.tipo}`,imgName=`${Album.titulo}_${sliderImagenActual}${Album.cfg.tipo}`,link=document.createElement("a");link.setAttribute("href",imgSrc),link.setAttribute("target","_blank"),link.download=imgName,document.body.appendChild(link),link.click(),document.body.removeChild(link)}document.addEventListener("DOMContentLoaded",(function(){console.log("Iniciando App"),obtenerDatosDelAlbum(),abrirVentana("info")}));const Slider={Play:()=>{console.info("sliderPlay()"),sliderPlayState=!0,btnToggle.children[0].src=iconsUrl+"pausa.svg"},Pausa:()=>{console.info("sliderPausa()"),sliderPlayState=!1,btnToggle.children[0].src=iconsUrl+"play.svg"},Toggle:()=>{sliderPlayState?Slider.Pausa():Slider.Play()},ProximaImagen:()=>{sliderImagenActual===Album.cfg.fotos?sliderImagenActual=1:sliderImagenActual++,Slider.CambiarImagen(sliderImagenActual)},CambiarImagen:img=>{sliderImagenActual=img;const imgSrc=`//${Album.cfg.url}${sliderImagenActual}${Album.cfg.tipo}`;console.info(`Cambiando a imagen: ${imgSrc}`),sliderImage.src=imgSrc}};function cargarDatosDelAlbum(){if(!Album.id)return!1;ventanaSlider.style.setProperty("--fotografo",'"Ⓒ '+Fotografo.nombre+'"'),sliderTimer=Album.cfg.timer;let fecha=new Date(Album.fecha);const options={weekday:"long",year:"numeric",month:"long",day:"numeric"},html=`\n        <h1 class="alb-Titulo">${Album.titulo}</h1>\n        <p class="alb-Fecha">${fecha.toLocaleDateString("es-AR",options)}</p>\n        <p class="alb-Lugar">${Album.lugar}</p>\n        <p class="alb-Fotos">\n          ${Album.cfg.fotos} imágenes, \n          ${Math.round(Album.cfg.fotos*Album.cfg.timer/1e3/60)}\n          min. de reproducción</p>\n        <button id="iniciarSlider" \n          class="shadow" \n          onclick="abrirVentana('slider');toggleFullScreen()">Iniciar álbum</button>\n        <h1 class="fot-Nombre">${Fotografo.nombre}</h1>\n        <p class="fot-web">\n          <a href="${Fotografo.web}" target="_blank" rel="noopener noreferrer">\n          ${Fotografo.web}</a>\n        <p class="fot-Tel">\n          <a href="tel:+${Fotografo.telelefono}">Tel:${Fotografo.telelefono}</a>\n        </p>\n        <p class="fot-email">\n          <a href="mailto:${Fotografo.email}">${Fotografo.email}</a>\n        </p>\n        `,container=document.querySelector("#info > div");container.innerHTML=html}function cargarGaleria(){const urlImgs=`https://storage.googleapis.com/mialbum.ga/${Album.id}/imgs`,primeraImagen=`${urlImgs}/1${Album.cfg.tipo}`;ventanaInfo.style.backgroundImage=`url(${primeraImagen})`,sliderImage.src=primeraImagen;let container=document.querySelector("#galeria .container");for(let i=1;i<=Album.cfg.fotos;i++){const el=document.createElement("img");el.setAttribute("src",`https://storage.googleapis.com/mialbum.ga/${Album.id}/imgs/${i+Album.cfg.tipo}`),el.setAttribute("alt",Album.titulo),el.setAttribute("onclick",`Slider.CambiarImagen(${i});abrirVentana('slider')`),container.appendChild(el)}}function obtenerDatosDelAlbum(){albumId=window.location.hash.replace("#",""),console.info(`Obteniendo datos del álbum ${albumId}`),Promise.all([getJson("albumes.json"),getJson("fotografos.json")]).then(data=>{if(Album=data[0].filter(item=>item.id===albumId)[0],!Album){console.error("No se encuentra el álbum ID: "+albumId);const container=document.querySelector("#info > div");return container.innerHTML=`<h1>No existe el álbum ${albumId}</h1>`,abrirVentana("info"),!1}if(console.info("Álbum",Album),Album.id!==albumId)throw new Error(`No existe el álbum ${albumId}`);Fotografo=data[1].filter(item=>item.id===Album.fid)[0],console.info("Fotógrafo:",Fotografo),cargarDatosDelAlbum(),cargarGaleria()})}async function getJson(db){try{console.info(`Obteniendo base de datos: ${databaseUrl+db}`);let response=await fetch(databaseUrl+db);return await response.json()}catch(err){console.error("database:"+databaseUrl+db),console.error(err)}}function toggleFullScreen(){return!1}async function shareAlbum(){try{if(!("share"in navigator))throw"navigator.share() no disponible";await navigator.share({url:location.href})}catch(error){console.error(error)}}setInterval(()=>{if(!Album)return!1;sliderPlayState&&Slider.ProximaImagen()},sliderTimer);